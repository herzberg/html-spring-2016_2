<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Chat rooms</title>
		<script src="https://code.jquery.com/jquery-latest.js"></script>
		<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
		<script>
			$(document).ready(function(){
				console.log("test")
				var domainName = 'https://herzberg.github.io/html-spring-2016_2/final/rooms/'
				var fireRooms = new Firebase('https://dafrol1rooms.firebaseio.com/')
				fireRooms.on('value',function(snapshot){
		            values = snapshot.val()
		            roomsDiv = $("#rooms")
		            roomsDiv.html("")
		            for(var key in values){
		                room = values[key]
		                for(var randKey in room){
		                	person = room[randKey]
			                console.log("item fireroom 5",randKey, person)
			                if(person.time < (new Date()).getTime() - 40000){
			                    json1 = {}
			                    json1[key] = {}
			                    json1[key][randKey] = null;
			                    fireRooms.update(json1)
			                }	
		                }


		                link = domainName + '?p=' + key
		                roomsDiv.append("<a href='" + link + "'>" + key.substring(0,6) + ": " + Object.keys(room).length + "</a><br>")
		            }            
		            roomsDiv.append("<a href='" + domainName + "'><b>New Room</b></a>")
	    		})
				/*
	    		fireRoom.on('value',function(snapshot){
		            values = snapshot.val()
		            currTime = (new Date()).getTime()
		            for(var key in values){
		                value = values[key]
		                console.log("item fireroom",key, value)
		                if(value.time <  (new Date()).getTime() - 40000){
		                    json1 = {}
		                    json1[key] = null;
		                    fireRoom.update(json1)
		                }
		            }
		        });*/
			});
		</script>
		<style>
			body{
				text-decoration: none;
				text-align: center;
				background-color: #347088;
			}
			a{
				text-decoration: none;
				padding: 20px;
				color:#111;
				font-size: 2em;
			}
			a:hover{
				color: #99b;
			}
			h2{
				font-size: 2.5em;
				font-family: Impact, Charcoal, sans-serif;
			}
		</style>

	</head>
	<body>
	<div id='roomContainer'>
        <h2>Rooms</h2>
        <div id='rooms'>

        </div>
    </div>

	</body>
</html>