<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Lobby</title>
		<link href="lobby.css"  media="screen" rel="stylesheet" />
		<script src="https://code.jquery.com/jquery-latest.js"></script>
		<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
		<script>
			$(document).ready(function(){
				console.log("test")
				var domainName = 'https://herzberg.github.io/html-spring-2016_2/final/rooms/'
				var fireRooms = new Firebase('https://dafrol1rooms.firebaseio.com/')
				$("#rooms").append("<a href='" + domainName + "'><b>New Room</b></a>")
				fireRooms.on('value',function(snapshot){
		            values = snapshot.val()
		            roomsDiv = $("#rooms")
		            roomsDiv.html("")
		            for(var key in values){
		                room = values[key]
		                roomCount = 0
		                for(var randKey in room){
		                	person = room[randKey]
			                console.log("item fireroom 5",randKey, person)
			                if(person.time < (new Date()).getTime() - 10000){
			                    json1 = {}
			                    json1[key] = {}
			                    json1[key][randKey] = null;
			                    fireRooms.update(json1)
			                }else{
			                	roomCount++;
			                }
		                }


		                link = domainName + '?p=' + key
		                roomsDiv.append("<a href='" + link + "'>" + key.substring(0,6) + ": " + roomCount + "</a><br>")
		            }            
		            roomsDiv.append("<a href='" + domainName + "'><b>New Room</b></a>")
	    		})
				

			});
		</script>

	</head>
	<body>
	<div id='roomContainer'>
        <h2>Rooms</h2>
        <div id='rooms'>

        </div>
    </div>

	</body>
</html>