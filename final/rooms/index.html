<!DOCTYPE html>
<html>
<head>
    <title>Daf Roulette</title>
    <meta charset="utf-8" />
    <link href="css/example.css" rel="stylesheet" />

    <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
    <script src="XSockets.latest.js"></script>
    <script src="XSockets.WebRTC.latest.js"></script>
    <script src="https://code.jquery.com/jquery-latest.js"></script>
    <script src="chat.js"></script>

</head>
<body>
    
        
        <div id='allVideos'>
            <!-- <h2>Remote videos</h2> -->
            <div class="localvideo">
                <video autoplay></video>
            </div>
            <div class="remotevideos"></div>
             
            
        
            
            

            
            <!-- <p>Click on vid to mute</p> -->
            <ul></ul>


            <small><small>
            <div id="immediate"><h5>Trace</h5></div>
            </small></small>
        </div>
        <div id='roomInfo'>
            <span id='peerlink'></span>
            <span id='roomCount'></span>
        </div>
    <div id='container'>

        <div id='sefariaText'>
        </div>
        <div id='chatbox'>
            <h3>Chat box</h3>
            <div id='messagesDiv'></div>
            <input type='text' id='nameInput' placeholder='Name'>
            <input type='text' id='messageInput' placeholder='Message'>
            <button onclick="sendChatMessage()">Send</button>     
        </div>
    </div>
    

    <script src="videos.js"></script>
    <script>
        function writePage(ref){
            path = "http://www.sefaria.org/api/texts/" + ref + "?commentary=0";
            newPath = "https://jsonp.afeld.me/?url=" + path
            wwwPath = "http://www.sefaria.org/" + ref
            $.getJSON(newPath, function(response2){
                $("#sefariaText").append("<a href='" + wwwPath + "'><h1>"+response2.title + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " + response2.heTitle +  "</h1></a>")
                text = response2.text;
                heText = response2.he;
                for(var i=0; i<heText.length; i++) {
                    if(text[i]){
                        line = "<div class='verse'>" + heText[i] + "<br>" + text[i] + "</div>"
                    }else{
                        line = "<span class='verse'>" + heText[i] + "</span>"
                    }
                    $("#sefariaText").append(line);
                }
            });
        }
            $(document).ready(function(){
                console.log("test")
                today = new Date()
                dateStr = (today.getMonth() +1) + "/" + today.getDate() + "/" + today.getFullYear();
                console.log("dateStr",dateStr)
                $.getJSON("daf-yomi.json",{}, function( data ){ 
                    
                    list = data.list
                    daf = null
                    for(i=0;i<list.length;i++){
                        obj = list[i]
                        if(obj.date == dateStr){
                            daf = obj.daf
                            break
                        }
                    } 

                    daf = daf.split(" ")
                    book = daf[0]
                    page = daf[1]
                    
                    ref = book + "." + page + "a"
                    writePage(ref)
                    ref = book + "." + page + "b"
                    writePage(ref)
                    
                  
                });
               
                 
                
                

            });
        </script>
</body>
</html>
